<!DOCTYPE html>
<html>
<head>

	<meta charset="UTF-8">
	<link type="text/css" rel="stylesheet" href="sagame_fl2016.css" />
	<title>Logisafe</title>

        
	<script language="javascript" type="text/javascript" src="../freebike/js/jquery-2.1.4.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/jquery-ui.min.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/dexie.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/FileSaver.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/common.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/markerlib.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/sagame.js"></script>
    <script language="javascript" type="text/javascript" src="config/config.js"></script>
    <script language="javascript" type="text/javascript">
    
        function showScores(gameName) {
            /**
                Update the scores display (using the game name and element id)
            */
            var scores = getScores(gameName);
            var txt = "";
            if (scores == null) {
                txt = ""; 
                } else {
                txt = 'Pisteet: '+ scores.points + "/" + scores.maxPoints;
            }
            $("#scores_"+ gameName).html(txt);
        }

    
        function showGames() {
            var playerScores = null;
            var timeline = null;
            
            
            try {
                playerScores = JSON.parse(localStorage.getItem("Freebike.SAGame.scores"));
            } catch (e) {
                console.log("Scores not available");
            }
            
            $("#gamePractice").show();
            
            
            timeline = SAGAME.timeline['Test1'];
            $("#gameTest1").hide();
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameTest1").show();
                        if (playerScores['Test1']['completed'] == 1) {
                            $("#selectGameTest1").hide();
                            $("#instructionsTest1").hide();
                        } 
                        
                    }
                } catch (e) {  console.log(e); }
            } 
            
            timeline = SAGAME.timeline['Test2'];
            $("#gameTest2").hide();
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameTest2").show();
                        if (playerScores['Test2']['completed'] == 1) {
                            $("#selectGameTest2").hide();
                            $("#instructionsTest2").hide();
                        } 
                        
                    }
                } catch (e) { console.log(e); }
            }

            timeline = SAGAME.timeline['Inter1'];
             $("#gameIntervention1").hide();
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameIntervention1").show();
                        if (playerScores['Inter1']['completed'] == 1) {
                            $("#selectGameInter1").hide();
                            $("#instructionsInter1").hide();
                        } 

                    }
                 } catch (e) { console.log(e); }
            } 
            
            timeline = SAGAME.timeline['Inter2'];
            $("#gameIntervention2").hide();
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameIntervention2").show();
                        if (playerScores['Inter2']['completed'] == 1) {
                            $("#selectGameInter2").hide();
                            $("#instructionsInter2").hide();
                        } 
                    }
                } catch (e) {  console.log(e); }
            } 
            
            timeline = SAGAME.timeline['Inter3'];
            $("#gameIntervention3").hide();
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameIntervention3").show();
                        if (playerScores['Inter3']['completed'] == 1) {
                            $("#selectGameInter3").hide();
                            $("#instructionsInter3").hide();
                        } 
                    }
                        
                } catch (e) {  console.log(e);}
            } 
            
            timeline = SAGAME.timeline['Inter4'];
            $("#gameIntervention4").hide();
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameIntervention4").show();
                        if (playerScores['Inter4']['completed'] == 1) {
                            $("#selectGameInter4").hide();
                            $("#instructionsInter4").hide();
                        } 
                        
                    }
                } catch (e) {  console.log(e); }
            } 
            
            timeline = SAGAME.timeline['Inter5'];
            $("#gameIntervention5").hide();
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameIntervention5").show();
                        if (playerScores['Inter5']['completed'] == 1) {
                            $("#selectGameInter5").hide();
                            $("#instructionsInter5").hide();
                        } 
                    }
                } catch (e) {  console.log(e); }
            } 
            
            $("#gameTest3").hide();
            timeline = SAGAME.timeline['Test3'];
            if ((new Date(timeline.start).getTime() < Date.now()) && (Date.now() < new Date(timeline.end).getTime())) {
                try {
                    if (playerScores != null && playerScores[timeline.require]['completed'] == 1) {
                        $("#gameTest3").show();
                    }
                } catch (e) { console.log(e); }
            }
            
            if (playerScores != null) {
                showScores('practice');
                showScores('Test1');
                showScores('Test2');
                showScores('Test3');
                showScores('Inter1');
                showScores('Inter2');
                showScores('Inter3');
                showScores('Inter4');
                showScores('Inter5');
            }
        }

        
    
        function setupInteractionFL2016() {


            $("#selectGamePractice").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.practice; 
                SAGAME.currentGameName = 'practice';
            });



            $("#selectGamePilottiB").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.PilottiB; 
                SAGAME.currentGameName = 'PilottiB';
            });
            
            $("#selectGameTest1").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Test1; 
                SAGAME.currentGameName = 'Test1';
            });

            $("#selectGameTest2").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Test2;
                SAGAME.currentGameName = 'Test2';                
            });

            $("#selectGameTest3").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Test3;
                SAGAME.currentGameName = 'Test3';                
            });
            
            $("#selectGameInter1").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter1;
                SAGAME.currentGameName = 'Inter1';                
            });
            
            $("#selectGameInter2").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter2;
                SAGAME.currentGameName = 'Inter2';                
            });

            $("#selectGameInter3").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter3;
                SAGAME.currentGameName = 'Inter3';                
            });


            $("#selectGameInter4").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter4;
                SAGAME.currentGameName = 'Inter4';                
            });

            $("#selectGameInter5").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter5;
                SAGAME.currentGameName = 'Inter5';                
            });


            /*
            $("#selectGameF").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.F;
                SAGAME.currentGameName = 'F';                
            });
            
            $("#selectGameOngelmat").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Ongelmat;
                SAGAME.currentGameName = 'Ongelmat';
            });
            */
            
            // this is set also in the game proper, but we need them to display the games correctly
            $("#goHomeAfterGameButton").click(function() {
                console.log("rai1");
                showGames();
            });
            // this is set also in the game proper, but we need them to display the games correctly
            $("#exitGameButton").click(function() {
                console.log("rai2");
                showGames();
            });


        }
        
        
        
		$(document).ready(function() {
            console.log("0");
            var req1 = loadClipsetsFrom(clipsets_json);
            console.log("1");
            
            req1.done( function() { 
                var req2 = loadTargetsFrom(targets_json);
                
                req2.done( function() { 
                    
                    setupInteraction();
                    setupInteractionFL2016(); 
                    
                }).fail(function(err) {
                    console.log("Loading targets failed")
                    console.log(err);
                });
            }).fail(function(err) {
                console.log("Loading clipsets failed")
                console.log(err);
            });
        
            // we retrieve points and based on them select which games to show etc.
            $('#login').click(function() {
                
                var playerID = sessionStorage.getItem("Freebike.SAGame.player_id");
                getScoresFromServer(playerID).always( function() {
                    showGames();
                });
            });
        
        });
        
        
    </script>

</head>

<body>

    <div id="login" class="loginScreen">
        
        <h1>Logisafe</h1>
        
        <p>
        Syötä pelaajatunnuksesi
        <input id="playerId" type="text" value="" />
        </p>
        
        <p>
        <button id="loginButton">Aloita</button>
        
        
        <!-- <button id="showGameInstructions">Aloita</button> -->
        </p>

    </div>

    <div id="home" class="instructions">
        <button id="logoutButton" onclick="window.location.reload()">Kirjaudu ulos</button>
		
        <div id="gameLabelContainer"> 



            <div id="gameTest3" class="gameLabel">
                <h2>Lopputesti</h2>
                <button class="gameButton" id="selectGameTest3">Pelaa</button>
                <p><span id="scores_Test3"></span></p>
                <p id="instructionsTest3">
                Tee lopuksi lopputesti yhdellä pelikerralla. Varaa sen tekemiseen noin 20 minuuttia.
                </p>
            </div>
            
            <div id="gameIntervention5" class="gameLabel">
                <h2>Peli 5</h2>
                <button class="gameButton" id="selectGameInter5">Pelaa</button>
                <p><span id="scores_Inter5"></span></p>
                <p id="instructionsInter5">
                 Jokaisessa pelissä on 10 videota. Uusi peli avautuu kun olet pelannut edellisen kokonaan läpi. 
                </p>                 
            </div>

            <div id="gameIntervention4" class="gameLabel">
                <h2>Peli 4</h2>
                <button class="gameButton" id="selectGameInter4">Pelaa</button>
                <p><span id="scores_Inter4"></span></p>
                <p id="instructionsInter4">
                 Jokaisessa pelissä on 10 videota. Uusi peli avautuu kun olet pelannut edellisen kokonaan läpi. 
                </p>                 
            </div>

            <div id="gameIntervention3" class="gameLabel">
                <h2>Peli 3</h2>
                <button class="gameButton" id="selectGameInter3">Pelaa</button>
                <p><span id="scores_Inter3"></span></p>                
                <p id="instructionsInter3">
                 Jokaisessa pelissä on 10 videota. Uusi peli avautuu kun olet pelannut edellisen kokonaan läpi. 
                </p>                
            </div>
            
            <div id="gameIntervention2" class="gameLabel">
                <h2>Peli 2</h2>
                <button class="gameButton" id="selectGameInter2">Pelaa</button> 
                <p><span id="scores_Inter2"></span></p>
                <p id="instructionsInter2">
                 Jokaisessa pelissä on 10 videota. Uusi peli avautuu kun olet pelannut edellisen kokonaan läpi. 
                </p>
            </div>

            <div id="gameIntervention1" class="gameLabel">
                <h2>Peli 1</h2>
                <button class="gameButton" id="selectGameInter1">Pelaa</button>
                <p><span id="scores_Inter1"></span></p>
                <p id="instructionsInter1">
                Pelejä on yhteensä viisi. Jokaisessa on 10 videota. Uusi peli avautuu kun olet pelannut edellisen kokonaan läpi. 
                </p>
            </div>
            

            
            <div id="gameTest2" class="gameLabel">
                <h2>Välitesti</h2>
                <button class="gameButton" id="selectGameTest2">Pelaa</button>
                <p><span id="scores_Test2"></span></p>
                <p id="instructionsTest2">
                Tee koko testi yhdellä pelikerralla ja varaa sen tekemiseen noin 20 minuuttia.
                </p>
            </div>
            
            <div id="gameTest1" class="gameLabel">
                <h2>Alkutesti</h2>
                <button class="gameButton" id="selectGameTest1">Pelaa</button>
                <p><span id="scores_Test1"></span></p>
                <p id="instructionsTest1">
                Tee koko testi yhdellä pelikerralla ja varaa sen tekemiseen noin 20 minuuttia.
                </p>
            </div>

            <div id="gamePractice" class="gameLabel">
                <h2>Harjoittelu</h2>
                <p><span id="scores_practice"></span></p>
                <button class="gameButton" id="selectGamePractice">Pelaa</button>
                <p id="instructionsPractice">
                Tutustu peliin pelaamalla lyhyt harjoituspeli, joka sisältää neljä videota.
                </p>
                    
            </div>



        </div> 
		
        <!--
        <div>
            <p>Pikanäppäimet:<p>
            <p>a = seuraava video, z = edellinen video, r = uudestaan, c = piilota/näytä maski</p>
        </div>
        -->
    </div>


    
    <div id="endInstructions" class="instructions">
        <p>Onneksi olkoon! Pelasit kaikki tämän osion videot. </p>
        
        <p>Saamasi pisteet: <span id="scoresAfterDisplay"></span></p>

        <p><button id="goHomeAfterGameButton">Aloitussivulle</button></p>

    </div>

    <div id="practiceInstructions" class="instructions">
        
        <h1>Ohjeet</h1>
                
        
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta. <br /><br />
        Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi. <br /><br />
        Harmaalla taustalla on kaksi ympyrää.</p>
        </p>
        <em>Valitse ympyröistä se jonka kohdalla 
        oli turvallisuuden kannalta tärkein huomioitava tai varottava asia.</em> 
        </p>
        <!-- <p>Oikeasta valinnasta saat pisteen ja väärästä menetät.</p> -->
        
        <p>Oikeasta valinnasta saat yhden pisteen. Jos vastaat alle kahdessa sekunnissa, saat vielä lisäpisteen. Väärästä valinnasta menetät yhden pisteen. Kuitenkin jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>

        <br />
        <button id="startPractice">Pelaa</button>
    </div>


    <div id="gameInstructions" class="instructions">
               
        <h1>Ohjeet</h1>
        
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta.<br /> Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi.<br /> 
        Harmaalla taustalla on kaksi ympyrää.<p>
        <p><em>Valitse ympyröistä se jonka kohdalla oli turvallisuuden kannalta tärkein huomioitava tai varottava asia.</em></p>
        
        <p>Oikeasta valinnasta saat yhden pisteen. Jos vastaat alle kahdessa sekunnissa, saat yhden lisäpisteen. 
        <p>Väärästä valinnasta menetät yhden pisteen. Jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>
        
        <!-- 
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta. <br /><br />
        Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi. <br /><br />
        Harmaalla taustalla on kaksi ympyrää.</p>
        </p>
        <em>Valitse ympyröistä se jonka kohdalla 
        oli turvallisuuden kannalta tärkein huomioitava tai varottava asia.</em> 
        </p>
        
         <p>Oikeasta valinnasta saat yhden pisteen. Jos vastaat alle kahdessa sekunnissa, saat yhden lisäpisteen. 
         <p>Väärästä valinnasta menetät yhden pisteen. Jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>
        -->
        <br />
       <!--
        <h1>Ohjeet</h1>
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta. <br /><br />
        Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi. <br /><br />
        Harmaalla taustalla on kaksi ympyrää.<br /><br /> 
        Valitse ympyröistä se jonka kohdalla 
        oli turvallisuuden kannalta tärkein huomioitava tai varottava asia. 
        </p>
        <p>Oikeasta valinnasta saat yhden pisteen.<br />Jos vastaat alle kahdessa sekunnissa, saat vielä lisäpisteen.</p>

        <p>Väärästä valinnasta menetät yhden pisteen.<br />Kuitenkin jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>

        <br /> -->
        <button id="startGame">Pelaa</button>
    </div>

    <!-- This should not be here. -->
    <div id="calibrationInstruction" class="instructions">        
        <p>Tässä välissä kalibroidaan silmänliikekamera</p>
        <p><br /><br /></p>
        <p><button id="calibrationInstructionContinue">Jatka</button></p>
    </div>

    <div id="currentvideo"></div>

    <div class="target" id="target_template"></div>	

    <div id="screen">
        <div id="points">0</div>
        <div id="exitGameButton">Keskeytä</div>
        <video id="videoplayer" src="" preload="auto" muted></video> 
    </div>

    <div id="videoMask">
    </div>
    
    <div id="videoLoadingMsg"><p>Ladataan seuraavaa videota...</p></div>

    <button id="checkbutton">Tarkista</button> 
    <button id="nextbutton">Seuraava</button>
    
    
    <div class="query_feedback" id="query_feedback_template"></div>
	<div class="query_box" id="query_box_template"></div>
    <div class="query_multiple_choice" id="query_multiple_choice_template"></div>

    <!--
    <div id="mc_comment_box" class="mc_comment_box">
    
        <p id="mc_item_template_1">
            <input type="radio" name="mcItem1_selected" /><span id="mcItem1_text">RAi 1</span>
        </p>
        
        <p id="mc_item_template_2">
            <input type="radio" name="mcItem2_selected" /><span id="mcItem2_text">RAi 2</span>
        </p>
        
        <p id="mc_item_template_3">
            <input type="radio" name="mcItem3_selected" /><span id="mcItem3_text">Rai 3</span>
        </p>
    
    </div>
    -->
        
    
    <audio id="targethitplayer" src="media/targethit.mp3"></audio>
    <audio id="missplayer" src="media/188039__antumdeluge__bicycle-horn.wav"></audio>
    
    <!-- <img id="marker1" src="media/marker1.png" />
    <img id="marker2" src="media/marker2.png" />
    <img id="marker3" src="media/marker3.png" />
    <img id="marker4" src="media/marker4.png" /> -->
    
    
    
    
</body>
</html>
