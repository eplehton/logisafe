<!DOCTYPE html>
<html>
<head>

	<meta charset="UTF-8">
	<link type="text/css" rel="stylesheet" href="sagame_fl2016.css" />
	<title>Logisafe</title>

        
	<script language="javascript" type="text/javascript" src="../freebike/js/jquery-2.1.4.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/jquery-ui.min.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/dexie.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/FileSaver.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/common.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/markerlib.js"></script>
    <script language="javascript" type="text/javascript" src="../freebike/js/sagame.js"></script>
    <script language="javascript" type="text/javascript" src="config/config200.js"></script>
    <script language="javascript" type="text/javascript">
    
        function showScores(gameName) {
            /**
                Update the scores display (using the game name and element id)
            */
            var scores = getScores(gameName);
            var txt = "";
            if (scores == null) {
                txt = 'Ei vielä pelattu läpi';
            } else {
                txt = 'Pisteet: '+ scores.points + "/" + scores.maxPoints;
            }
            $("#scores_"+ gameName).html(txt);
        }

    
        function showGames() {
        
            var scores = null;
            try {
                scores = JSON.parse(localStorage.getItem("Freebike.SAGame.scores"));
            } catch (e) {
                console.log("Scores not available");
            }
            
            $("#gamePractice").show();
            
            $("#gameTest1").hide();
            if ((new Date("2017-09-01").getTime() < Date.now()) && (Date.now() < new Date("2030-10-21").getTime())) {
                try {
                    if (scores != null && scores['practice']['completed'] == 1) {
                        $("#gameTest1").show();
                    }
                } catch (e) { }
            } 
            
             $("#gameTest2").hide();
            if ((new Date("2017-09-01").getTime() < Date.now()) && (Date.now() < new Date("2017-10-21").getTime())) {
                try { 
                    if (scores != null && scores['Test1']['completed'] == 1) {
                        $("#gameTest2").show();
                    }
                } catch (e) { }
            }
            
             $("#gameIntervention1").hide();
            if ((new Date("2017-10-19").getTime() < Date.now()) && (Date.now() < new Date("2017-10-23").getTime())) {
                try { 
                    if (scores != null && scores['Test2']['completed'] == 1) {
                        $("#gameIntervention1").show();
                    }
                 } catch (e) { }
            } 
            
            $("#gameIntervention2").hide();
            if ((new Date("2017-09-01").getTime() < Date.now()) && (Date.now() < new Date("2030-10-23").getTime())) {
                try { 
                    if (scores != null && scores['Inter1']['completed'] == 1) {
                        $("#gameIntervention2").show();
                    }
                } catch (e) { }
            } 
            
            $("#gameIntervention3").hide();
            if ((new Date("2017-09-01").getTime() < Date.now()) && (Date.now() < new Date("2030-10-23").getTime())) {
                try { 
                    if (scores != null && scores['Inter2']['completed'] == 1) {
                        $("#gameIntervention3").show();
                    }
                } catch (e) { }
            } 
            $("#gameIntervention4").hide();
            if ((new Date("2017-09-01").getTime() < Date.now()) && (Date.now() < new Date("2030-10-23").getTime())) {
                try { 
                    if (scores != null && scores['Inter3']['completed'] == 1) {
                        $("#gameIntervention4").show();
                    }
                } catch (e) { }
            } 
            
            $("#gameIntervention5").hide();
            if ((new Date("2017-09-01").getTime() < Date.now()) && (Date.now() < new Date("2030-10-23").getTime())) {
                try { 
                    if (scores != null && scores['Inter4']['completed'] == 1) {
                        $("#gameIntervention5").show();
                    }
                } catch (e) { }
            } 
            
             $("#gameTest3").hide();
            if ((new Date("2017-10-20").getTime() < Date.now()) && (Date.now() < new Date("2030-10-25").getTime())) {
                try { 
                    // if (scores != null && scores['Inter5']['completed'] == 1) {
                        $("#gameTest3").show();
                    //}
                } catch (e) { }
            }
            
            if (scores != null) {
                showScores('practice');
                showScores('Test1');
                showScores('Test2');
                showScores('Test3');
                showScores('Inter1');
                showScores('Inter2');
                showScores('Inter3');
                showScores('Inter4');
                showScores('Inter5');
            }
        }

        
    
        function setupInteractionFL2016() {


            $("#selectGamePractice").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.practice; 
                SAGAME.currentGameName = 'practice';
            });



            $("#selectGamePilottiB").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.PilottiB; 
                SAGAME.currentGameName = 'PilottiB';
            });
            
            $("#selectGameTest1").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Test1; 
                SAGAME.currentGameName = 'Test1';
            });

            $("#selectGameTest2").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Test2;
                SAGAME.currentGameName = 'Test2';                
            });

            $("#selectGameTest3").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Test3;
                SAGAME.currentGameName = 'Test3';                
            });
            
            $("#selectGameInter1").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter1;
                SAGAME.currentGameName = 'Inter1';                
            });
            
            $("#selectGameInter2").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter2;
                SAGAME.currentGameName = 'Inter2';                
            });

            $("#selectGameInter3").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter3;
                SAGAME.currentGameName = 'Inter3';                
            });


            $("#selectGameInter4").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter4;
                SAGAME.currentGameName = 'Inter4';                
            });

            $("#selectGameInter5").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Inter5;
                SAGAME.currentGameName = 'Inter5';                
            });


            /*
            $("#selectGameF").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.F;
                SAGAME.currentGameName = 'F';                
            });
            
            $("#selectGameOngelmat").click(function() {
                $("#home").hide();
                $("#gameInstructions").show();
                SAGAME.currentClipset = SAGAME.CLIPSETS.Ongelmat;
                SAGAME.currentGameName = 'Ongelmat';
            });
            */
            
            // this is set also in the game proper, but we need them to display the games correctly
            $("#goHomeAfterGameButton").click(function() {
                console.log("rai1");
                showGames();
            });
            // this is set also in the game proper, but we need them to display the games correctly
            $("#exitGameButton").click(function() {
                console.log("rai2");
                showGames();
            });


        }
        
        
        
		$(document).ready(function() {
            console.log("0");
            var req1 = loadClipsetsFrom(clipsets_json);
            console.log("1");
            
            req1.done( function() { 
                var req2 = loadTargetsFrom(targets_json);
                
                req2.done( function() { 
                    
                    setupInteraction();
                    setupInteractionFL2016(); 
                    
                }).fail(function(err) {
                    console.log("Loading targets failed")
                    console.log(err);
                });
            }).fail(function(err) {
                console.log("Loading clipsets failed")
                console.log(err);
            });
        
            // we retrieve points and based on them select which games to show etc.
            $('#login').click(function() {
                
                var playerID = sessionStorage.getItem("Freebike.SAGame.player_id");
                getScoresFromServer(playerID).always( function() {
                    showGames();
                });
            });
        
        });
        
        
    </script>

</head>

<body>

    <div id="login" class="loginScreen">
        
        <h1>Logisafe</h1>
        
        <p>
        Syötä pelaajatunnuksesi
        <input id="playerId" type="text" value="" />
        </p>
        
        <p>
        <button id="loginButton">Aloita</button>
        
        
        <!-- <button id="showGameInstructions">Aloita</button> -->
        </p>

    </div>

    <div id="home" class="instructions">
        
        
        <h1>Valitse peli</h1>
        
		<div>
			<p>Uusi peli avautuu kun olet pelannut edellisen läpi.</p>
            <p>Halutessasi voit pelata pelejä uudestaan ja parantaa pisteitäsi.</p>
        </div>
		
        <div id="gameLabelContainer"> 



            <div id="gameTest3" class="gameLabel">
                <button id="selectGameTest3">
                Lopputesti (20 videota)
                <br />
                <span id="scores_Test3"></span> 
                </button>
            </div>
            
            <div id="gameIntervention5" class="gameLabel">
                <button id="selectGameInter5">
                Peli 5 (10 videota)
                <br />
                <span id="scores_Inter5"></span>
                </button>                
            </div>

            <div id="gameIntervention4" class="gameLabel">
                <button id="selectGameInter4">
                Peli 4 (10 videota)
                <br />
                <span id="scores_Inter4"></span>
                </button>                
            </div>

            <div id="gameIntervention3" class="gameLabel">
                <button id="selectGameInter3">
                Peli 3 (10 videota)
                <br />
                <span id="scores_Inter3"></span>
                </button>                
            </div>
            
            <div id="gameIntervention2" class="gameLabel">
                <button id="selectGameInter2">
                Peli 2 (10 videota)
                <br />
                <span id="scores_Inter2"></span>
                </button>                
            </div>

            <div id="gameIntervention1" class="gameLabel">
                <button id="selectGameInter1">
                Peli 1 (10 videota)
                <br />
                <span id="scores_Inter1"></span>
                </button>                
            </div>
            

            
            <div id="gameTest2" class="gameLabel">
                <button id="selectGameTest2">
                Välitesti (20 videota)
                <br />
                <span id="scores_Test2"></span>
                </button>                
            </div>
            
            <div id="gameTest1" class="gameLabel">
                <button id="selectGameTest1">
                    Alkutesti (20 videota)
                    <br />
                    <span id="scores_Test1"></span>
                </button>
            </div>

            <div id="gamePractice" class="gameLabel">
                <button id="selectGamePractice">
                    Harjoittelu (4 videota)
                    <br />
                    <span id="scores_practice"></span>
                </button>
            </div>



        </div> 
		
        <!--
        <div>
            <p>Pikanäppäimet:<p>
            <p>a = seuraava video, z = edellinen video, r = uudestaan, c = piilota/näytä maski</p>
        </div>
        -->
    </div>


    
    <div id="endInstructions" class="instructions">
        <p>Hienoa! Pelasit kaikki videot. </p>
        
        <p>Pisteet: <span id="scoresAfterDisplay"></span></p>

        <p><button id="goHomeAfterGameButton">Aloitussivulle</button></p>

    </div>

    <div id="practiceInstructions" class="instructions">
        
        <h1>Ohjeet</h1>
                
        
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta. <br /><br />
        Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi. <br /><br />
        Harmaalla taustalla on kaksi ympyrää.</p>
        </p>
        <em>Valitse ympyröistä se jonka kohdalla 
        oli turvallisuuden kannalta tärkein huomioitava tai varottava asia.</em> 
        </p>
        <!-- <p>Oikeasta valinnasta saat pisteen ja väärästä menetät.</p> -->
        
        <p>Oikeasta valinnasta saat yhden pisteen. Jos vastaat alle kahdessa sekunnissa, saat vielä lisäpisteen. Väärästä valinnasta menetät yhden pisteen. Kuitenkin jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>

        <br />
        <button id="startPractice">Pelaa</button>
    </div>


    <div id="gameInstructions" class="instructions">
               
        <h1>Ohjeet</h1>
        
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta.<br /> Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi.<br /> 
        Harmaalla taustalla on kaksi ympyrää.<p>
        <p><em>Valitse ympyröistä se jonka kohdalla oli turvallisuuden kannalta tärkein huomioitava tai varottava asia.</em></p>
        
        <p>Oikeasta valinnasta saat yhden pisteen. Jos vastaat alle kahdessa sekunnissa, saat yhden lisäpisteen. 
        <p>Väärästä valinnasta menetät yhden pisteen. Jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>
        
        <!-- 
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta. <br /><br />
        Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi. <br /><br />
        Harmaalla taustalla on kaksi ympyrää.</p>
        </p>
        <em>Valitse ympyröistä se jonka kohdalla 
        oli turvallisuuden kannalta tärkein huomioitava tai varottava asia.</em> 
        </p>
        
         <p>Oikeasta valinnasta saat yhden pisteen. Jos vastaat alle kahdessa sekunnissa, saat yhden lisäpisteen. 
         <p>Väärästä valinnasta menetät yhden pisteen. Jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>
        -->
        <br />
       <!--
        <h1>Ohjeet</h1>
        <p>Pelissä näet videoita trukinkuljettajan näkökulmasta. <br /><br />
        Jossain vaiheessa video pysähtyy ja kuva muuttuu harmaaksi. <br /><br />
        Harmaalla taustalla on kaksi ympyrää.<br /><br /> 
        Valitse ympyröistä se jonka kohdalla 
        oli turvallisuuden kannalta tärkein huomioitava tai varottava asia. 
        </p>
        <p>Oikeasta valinnasta saat yhden pisteen.<br />Jos vastaat alle kahdessa sekunnissa, saat vielä lisäpisteen.</p>

        <p>Väärästä valinnasta menetät yhden pisteen.<br />Kuitenkin jos annat väärän vastauksen alle kahdessa sekunnissa, menetät kaksi pistettä.</p>

        <br /> -->
        <button id="startGame">Pelaa</button>
    </div>

    <!-- This should not be here. -->
    <div id="calibrationInstruction" class="instructions">        
        <p>Tässä välissä kalibroidaan silmänliikekamera</p>
        <p><br /><br /></p>
        <p><button id="calibrationInstructionContinue">Jatka</button></p>
    </div>

    <div id="currentvideo"></div>

    <div class="target" id="target_template"></div>	

    <div id="screen">
        <div id="points">0</div>
        <div id="exitGameButton">Keskeytä</div>
        <video id="videoplayer" src="" preload="auto" muted></video> 
    </div>

    <div id="videoMask">
    </div>
    
    <div id="videoLoadingMsg"><p>Ladataan seuraavaa videota...</p></div>

    <button id="checkbutton">Tarkista</button> 
    <button id="nextbutton">Seuraava</button>
    
    
    <div class="query_feedback" id="query_feedback_template"></div>
	<div class="query_box" id="query_box_template"></div>
    <div class="query_multiple_choice" id="query_multiple_choice_template"></div>

    <!--
    <div id="mc_comment_box" class="mc_comment_box">
    
        <p id="mc_item_template_1">
            <input type="radio" name="mcItem1_selected" /><span id="mcItem1_text">RAi 1</span>
        </p>
        
        <p id="mc_item_template_2">
            <input type="radio" name="mcItem2_selected" /><span id="mcItem2_text">RAi 2</span>
        </p>
        
        <p id="mc_item_template_3">
            <input type="radio" name="mcItem3_selected" /><span id="mcItem3_text">Rai 3</span>
        </p>
    
    </div>
    -->
        
    
    <audio id="targethitplayer" src="media/targethit.mp3"></audio>
    <audio id="missplayer" src="media/188039__antumdeluge__bicycle-horn.wav"></audio>
    
    <!-- <img id="marker1" src="media/marker1.png" />
    <img id="marker2" src="media/marker2.png" />
    <img id="marker3" src="media/marker3.png" />
    <img id="marker4" src="media/marker4.png" /> -->
    
    
</body>
</html>
